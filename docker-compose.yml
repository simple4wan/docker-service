version: '3'
services:
  adguardhome:
    depends_on:
      - nginx
    image: adguard/adguardhome
    ports:
      - 53:53
      - 53:53/udp
      - 853:853
    restart: always
    volumes:
      - ./adguardhome/work:/opt/adguardhome/work
      - ./adguardhome/conf:/opt/adguardhome/conf
  homeassistant:
    environment:
      TZ: '${TZ}'
      PUID: ${PUID}
      PGID: ${PGID}
    image: linuxserver/homeassistant
    network_mode: host
    restart: always
    volumes:
      - ./homeassistant/config:/config
  mariadb:
    environment:
      TZ: '${TZ}'
      PUID: ${PUID}
      PGID: ${PGID}
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
    image: linuxserver/mariadb
    network_mode: host
    restart: always
    volumes:
      - ./mariadb/config:/config
  mitmproxy:
    command: /bin/bash -c "cd /home/mitmproxy/.mitmproxy && pip install -r requirements.txt && mitmdump"
    environment:
      TZ: '${TZ}'
    image: mitmproxy/mitmproxy
    ports:
      - 58080:58080
      - 58081:8081
      - 51080:1080
      - 51080:1080/udp
    restart: always
    volumes:
      - ~/.mitmproxy:/home/mitmproxy/.mitmproxy
  nginx:
    environment:
      TZ: '${TZ}'
      PUID: ${PUID}
      PGID: ${PGID}
    image: linuxserver/nginx
    ports:
      - 8443:8443
    restart: always
    volumes:
      - ./nginx/config:/config
      - /root/.acme.sh:/.acme.sh
  node-red:
    environment:
      TZ: '${TZ}'
    image: nodered/node-red
    network_mode: host
    restart: always
    volumes:
      - ./node-red/data:/data
  portainer:
    command: -H unix:///var/run/docker.sock
    depends_on:
      - nginx
    image: portainer/portainer-ce
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./portainer/data:/data
  scrypted:
    environment:
      TZ: '${TZ}'
    image: koush/scrypted
    network_mode: host
    restart: always
    volumes:
      - ./scrypted/data:/server/volume
  transmission:
    depends_on:
      - nginx
    environment:
      TZ: '${TZ}'
      PUID: ${PUID}
      PGID: ${PGID}
      TRANSMISSION_WEB_HOME: '${TRANSMISSION_WEB_HOME}'
      USER: '${TRANSMISSION_USER}'
      PASS: '${TRANSMISSION_PASS}'
    image: ghcr.io/linuxserver/transmission
    ports:
      - 51413:51413
      - 51413:51413/udp
    restart: always
    volumes:
      - ./transmission/config:/config
      - ./transmission/downloads:/downloads
      - ./transmission/watch:/watch
  watchtower:
    environment:
      WATCHTOWER_CLEANUP: 'true'
    image: containrrr/watchtower
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

